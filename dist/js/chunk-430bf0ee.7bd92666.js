(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-430bf0ee"],{"06fa":function(e,s,t){"use strict";var a=t("faf6"),r=t.n(a);r.a},1311:function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"self-grade-component"},[t("section",{staticClass:"mark"},[t("el-row",{attrs:{align:"middle",type:"flex"}},[t("el-col",{staticStyle:{padding:"20px","border-right":"1px solid #979797"},attrs:{span:14}},[t("div",{staticClass:"mark-label"},[e._v("请选择评分项目")]),t("grade-items",{attrs:{items:e.questions},model:{value:e.selectGradeItem,callback:function(s){e.selectGradeItem=s},expression:"selectGradeItem"}}),t("br"),t("br"),t("div",{staticClass:"mark-label"},[e._v("请评分")]),t("br"),t("grade-slider",{attrs:{min:1,readOnly:e.readOnly,step:1,max:5,labels:e.constants.markLabels},model:{value:e.questions[e.selectGradeItem].score,callback:function(s){e.$set(e.questions[e.selectGradeItem],"score",s)},expression:"questions[selectGradeItem].score"}})],1),t("el-col",{staticStyle:{"padding-left":"50px"},attrs:{span:10}},[t("div",{staticClass:"mark-score"},[e._v("\n          "+e._s(e.questions[e.selectGradeItem].score&&e.questions[e.selectGradeItem].score>=0?e.questions[e.selectGradeItem].score:"")+"分\n        ")]),t("div",{staticClass:"mark-desc"},[e._v(e._s(e.contentForCurScore))])])],1)],1),t("br"),t("div",{directives:[{name:"show",rawName:"v-show",value:e.questions[e.selectGradeItem].score>=3,expression:"questions[selectGradeItem].score >= 3"}]},[t("case-area",{attrs:{readOnly:e.readOnly,placeholder:e.casePlaceholders[0]},model:{value:e.questions[e.selectGradeItem].cases[0],callback:function(s){e.$set(e.questions[e.selectGradeItem].cases,0,s)},expression:"questions[selectGradeItem].cases[0]"}}),t("br"),t("div",{directives:[{name:"show",rawName:"v-show",value:e.questions[e.selectGradeItem].score>=4,expression:"questions[selectGradeItem].score >= 4"}]},[t("case-area",{attrs:{readOnly:e.readOnly,placeholder:e.casePlaceholders[1]},model:{value:e.questions[e.selectGradeItem].cases[1],callback:function(s){e.$set(e.questions[e.selectGradeItem].cases,1,s)},expression:"questions[selectGradeItem].cases[1]"}}),t("br"),t("div",{directives:[{name:"show",rawName:"v-show",value:e.questions[e.selectGradeItem].score>=5,expression:"questions[selectGradeItem].score >= 5"}]},[t("case-area",{attrs:{readOnly:e.readOnly,placeholder:e.casePlaceholders[2]},model:{value:e.questions[e.selectGradeItem].cases[2],callback:function(s){e.$set(e.questions[e.selectGradeItem].cases,2,s)},expression:"questions[selectGradeItem].cases[2]"}}),t("br")],1)],1)],1),t("el-row",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],attrs:{type:"flex",justify:"end"}},[e.neverSubmit?t("el-button",{attrs:{type:"primary"},on:{click:e.saveDraft}},[e._v(e._s(e.constants.SAVE_DRAFT))]):e._e(),t("el-button",{attrs:{type:"primary"},on:{click:e.submitGrade}},[e._v(e._s(e.constants.SUBMIT))])],1)],1)},r=[],n=(t("a481"),t("ac6a"),t("6762"),t("2fdb"),t("cebc")),c=(t("6c7b"),t("fea5")),o=t("38fb"),l=t("c9f1"),u={props:{isManager:{type:Boolean,default:!1}},data:function(){return{selectGradeItem:0,neverSubmit:!0,questions:[{cases:["","",""]},{cases:["","",""]},{cases:["","",""]},{cases:["","",""]}],readOnly:!1,constants:{SUBMIT:o["me"],SAVE_DRAFT:o["ae"],markLabels:["红线","胜任","优秀","超预期","卓越"]}}},components:{"grade-items":function(){return t.e("chunk-51b546f8").then(t.bind(null,"da3f"))},"grade-slider":function(){return t.e("chunk-4f7c9932").then(t.bind(null,"aa29"))},"case-area":function(){return t.e("chunk-502749a0").then(t.bind(null,"b5ec"))}},methods:{getGradeInfo:function(){var e=this,s=this.$route.params.id;Object(c["O"])(s).then(function(t){var a=1==t.is_new_record;e.neverSubmit=a,a?Object(c["P"])(s).then(function(s){e.preProcessQuestions(s.questions)}):e.preProcessQuestions(t.questions);var r=t.employee_name,n=t.employee_workcode,i=t.highlevel_name,o=t.highlevel_workcode,l=t.self_end_time,u=t.superior_name,d=t.superior_workcode;e.$parent.basicInfo={name:r,workcode:n,leaderLabel:"我的上级",superior_name:u,highlevel_name:i,superior_workcode:d,hightlevelLabel:"隔级上级",highlevel_workcode:o,finishedTime:"自评截止时间: ".concat(l)},e.readOnly=0==t.can_edit,e.$forceUpdate()})},preProcessQuestions:function(e){var s=this;e.map(function(e,t){if(!e.cases)return e.cases=new Array(3).fill(""),void s.$set(s.questions,t,Object(n["a"])({},e));if(3!=e.cases.length)for(var a=0;a<=3-e.cases.length;a++)e.cases[e.cases.length+a]="";s.$set(s.questions,t,Object(n["a"])({},e))})},scoreCheck:function(e,s){if(e.score==s){var t=this.caseValidate(e,s);if(-1!=t)return this.$message.error("".concat(i.question_name).concat(t+3,"分理由未填写，请填写后提交!")),!0}return!1},validateGrade:function(){var e=this;return this.questions.some(function(s){return s.score?!(![3,4,5].includes(parseInt(s.score))||!e.scoreCheck(s)):(e.$message.error("".concat(s.question_name,"评分未选择!")),!0)})},caseValidate:function(e,s){for(var t=s-3,a=0;a<=t;a++)if(void 0==e.cases[a]||0==e.cases[a].length)return a;return-1},composeData:function(){var e={};return this.filterCases(this.questions).forEach(function(s){e[s.question_id]={score:s.score,cases:s.cases.filter(function(e){return!!e})}}),e},filterCases:function(e){return e.map(function(e){return e.cases&&0!=e.cases.length&&(e.cases=e.cases.slice(0,e.score-2)),e})},submitGrade:function(){var e=this,s=this.validateGrade();if(!s){var t=this.composeData();Object(c["jc"])(t,this.$route.params.id).then(function(s){e.$notify({title:o["ne"],message:o["D"],type:"success"}),e.$router.replace(l["R"])})}},saveDraft:function(){var e=this;Object(c["hc"])(this.$route.params.id,Object(n["a"])({},this.composeData(),{type:1})).then(function(s){e.$notify({title:o["ne"],message:o["ab"],type:"success"})})}},computed:{contentForCurScore:function(){var e=this;return((this.questions[this.selectGradeItem].topics||[]).filter(function(s){return s.score==e.questions[e.selectGradeItem].score})[0]||{}).content},casePlaceholders:function(){var e=["要求为近半年的案例，需体现有主动意识，个人行为产生的正面影响，需列举1个案例；","要求为近半年的案例，需体现有影响力，有进取心并不断突破，行为由己到人，能够带动和影响他人，需列举1个案例；","要求为近半年的案例，需体现对组织有贡献，有高度也有落地的方法，能够系统的解决问题并产生深远的影响，需列举1个案例；"],s=["要求为近半年的案例，要求有影响力，要体现对团队，组织的影响力，需列举1个案例","要求为近半年的案例，要求建立机制，要体现通过建立机制从根本上解决问题，需列举1个案例；","要求为近半年的案例，要求要有战功，要体现给业务或工作带来的突破性贡献和价值，需列举1个案例；"];return this.isManager?s:e}},created:function(){this.getGradeInfo()}},d=u,f=(t("06fa"),t("2877")),m=Object(f["a"])(d,a,r,!1,null,"48484a0f",null);s["default"]=m.exports},"2fdb":function(e,s,t){"use strict";var a=t("5ca1"),r=t("d2c8"),n="includes";a(a.P+a.F*t("5147")(n),"String",{includes:function(e){return!!~r(this,e,n).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},"36bd":function(e,s,t){"use strict";var a=t("4bf8"),r=t("77f1"),n=t("9def");e.exports=function(e){var s=a(this),t=n(s.length),c=arguments.length,i=r(c>1?arguments[1]:void 0,t),o=c>2?arguments[2]:void 0,l=void 0===o?t:r(o,t);while(l>i)s[i++]=e;return s}},5147:function(e,s,t){var a=t("2b4c")("match");e.exports=function(e){var s=/./;try{"/./"[e](s)}catch(t){try{return s[a]=!1,!"/./"[e](s)}catch(r){}}return!0}},6762:function(e,s,t){"use strict";var a=t("5ca1"),r=t("c366")(!0);a(a.P,"Array",{includes:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),t("9c6c")("includes")},"6c7b":function(e,s,t){var a=t("5ca1");a(a.P,"Array",{fill:t("36bd")}),t("9c6c")("fill")},aae3:function(e,s,t){var a=t("d3f4"),r=t("2d95"),n=t("2b4c")("match");e.exports=function(e){var s;return a(e)&&(void 0!==(s=e[n])?!!s:"RegExp"==r(e))}},d2c8:function(e,s,t){var a=t("aae3"),r=t("be13");e.exports=function(e,s,t){if(a(s))throw TypeError("String#"+t+" doesn't accept regex!");return String(r(e))}},faf6:function(e,s,t){}}]);