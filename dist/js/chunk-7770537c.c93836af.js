(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7770537c"],{"08d2":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"my-grade-page"},[s("section",{staticClass:"content-container"},[s("div",{staticClass:"basic-info"},[s("span",{staticClass:"label"},[e._v(e._s(e.constants.BASIC_INFO)+":")]),s("span",[s("span",{staticClass:"greycolor"},[e._v(e._s(e.constants.LEADER_NUMBER))]),e._v("\n        / "+e._s(e.basicInfo.superior_workcode)+"   \n        "),s("span",{staticClass:"greycolor"},[e._v(e._s(e.constants.LEADER_NAME))]),e._v("\n        / "+e._s(e.basicInfo.superior_name)+" ")]),e._v("    \n      "),s("span",{staticClass:"tip"},[e._v("注: 若上级姓名工号与实际不符, 请联系HR")])]),s("br"),e._l(e.cardData,function(t,a){return s("card",{key:a,staticClass:"card",attrs:{readOnly:e.readOnly,placeholder:"请描述该项目标的实际完成情况",desc:e.targets[a].desc,config:e.cardConfig,data:t,index:a},on:{"update:desc":function(t){return e.$set(e.targets[a],"desc",t)}},model:{value:e.targets[a].mark,callback:function(t){e.$set(e.targets[a],"mark",t)},expression:"targets[i].mark"}})}),s("br"),e.showComments&&e.superior_score&&e.superior_score.evaluation&&e.published?s("div",[s("comments",{attrs:{readOnly:!0,comments:e.superior_score&&e.superior_score.evaluation},on:{"update:comments":function(t){return e.$set(e.superior_score&&e.superior_score,"evaluation",t)}}}),s("br")],1):e._e(),e.showMyAdditional?s("div",[s("addition-mark",{attrs:{prefixTitle:e.constants.LABEL_SELF,readOnly:e.readOnly,desc:e.myAdditionMark.evaluation,mark:e.myAdditionMark.score},on:{"update:desc":function(t){return e.$set(e.myAdditionMark,"evaluation",t)},"update:mark":function(t){return e.$set(e.myAdditionMark,"score",t)}}}),s("br")],1):e._e(),e.leaderAdditionMark.evaluation&&e.published?s("div",[s("addition-mark",{attrs:{readOnly:!0,prefixTitle:e.constants.LABEL_SUP,desc:e.leaderAdditionMark.evaluation,mark:e.leaderAdditionMark.score},on:{"update:desc":function(t){return e.$set(e.leaderAdditionMark,"evaluation",t)},"update:mark":function(t){return e.$set(e.leaderAdditionMark,"score",t)}}}),s("br")],1):e._e(),e.showTotal&&e.canEdit?s("div",[s("total-mark",{attrs:{total:e.total,score:e.total,high_level_show:e.published}}),s("br")],1):e._e(),e.showTotal&&!e.canEdit?s("div",[s("total-mark",{attrs:{total:e.total,score:e.self_score,high_level_show:e.published&&!!e.superior_evaluation}}),s("br")],1):e._e(),s("div",[e.level&&e.published?s("el-row",{staticClass:"level-section",attrs:{type:"flex",justify:"end"}},[s("el-col",{attrs:{span:4}},[s("el-row",{attrs:{justify:"center"}},[s("el-col",{attrs:{span:6}},[s("span",{staticStyle:{"line-height":"40px"}},[e._v("结果/")])]),s("el-col",{attrs:{span:18}},[s("span",{staticClass:"level"},[e._v("\n                "+e._s(e.level)+"\n              ")])])],1),s("br"),e.label_show?s("el-row",[s("el-col",{attrs:{span:6}},[e._v("标签/")]),s("el-tag",{class:"A"==e.level||"S"==e.level?"status-tag top-style":"status-tag other-style"},[e._v(e._s(e.label_name))])],1):e._e()],1)],1):e._e()],1),e.canEdit?s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-button",{staticClass:"btn-reset",attrs:{round:"",size:"medium"},on:{click:e.saveDraft}},[e._v("\n        "+e._s(e.constants.SAVE_DRAFT)+"\n      ")]),s("el-button",{attrs:{round:"",size:"medium",type:"primary"},on:{click:e.submit}},[e._v("\n        "+e._s(e.constants.SUBMIT)+"\n      ")])],1):e._e(),e.superior_evaluation?s("div",[e.is_confirm||e.is_appeal||e.is_cancel_appeal?s("p",{staticStyle:{color:"#eb0c00"}},[e._v("\n        请注意：到期将默认确认结果, 如有问题可点击申诉\n      ")]):e._e(),s("p",{staticStyle:{width:"100%","word-break":"break-all",color:"#ff8519"}},e._l(e.appeal,function(t,a){return s("span",{key:a},[e._v("\n          申诉理由："+e._s(t.reason)+" "),s("br")])}),0),s("el-row",{attrs:{type:"flex",justify:"center"}},[e.is_confirm?s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.confirm_box_show=!0}}},[e._v("\n          确认\n        ")]):e._e(),e.is_appeal?s("el-button",{attrs:{type:"warning"},on:{click:function(t){e.appeal_box_show=!0}}},[e._v("\n          申诉\n        ")]):e._e(),e.is_cancel_appeal?s("el-button",{attrs:{type:"warning"},on:{click:function(t){e.cancel_appeal_box_show=!0}}},[e._v("\n          取消申诉\n        ")]):e._e()],1)],1):e._e(),s("el-dialog",{staticClass:"dialog",attrs:{title:"提示",visible:e.confirm_box_show,width:"30%"},on:{"update:visible":function(t){e.confirm_box_show=t}}},[s("p",{staticClass:"text-center"},[e._v("是否确认成绩")]),s("span",{staticClass:"text-center",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.confirm_box_show=!1}}},[e._v("\n          取消\n        ")]),s("el-button",{attrs:{type:"primary"},on:{click:e.confirm_submit}},[e._v("\n          确认\n        ")])],1)]),s("reject-dialog",{attrs:{visible:e.appeal_box_show},on:{close:e.getInfo,"update:visible":function(t){e.appeal_box_show=t}}}),s("el-dialog",{staticClass:"dialog",attrs:{title:"提示",visible:e.cancel_appeal_box_show,width:"30%"},on:{"update:visible":function(t){e.cancel_appeal_box_show=t}}},[s("p",{staticClass:"text-center"},[e._v("\n        取消申诉将默认为自动确认当前成绩，是否继续？\n      ")]),s("span",{staticClass:"text-center",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.cancel_appeal_box_show=!1}}},[e._v("\n          取消\n        ")]),s("el-button",{attrs:{type:"primary"},on:{click:e.cancel_appeal_submit}},[e._v("\n          确认\n        ")])],1)])],2)])},r=[],n=(s("a481"),s("cebc")),o=s("38fb"),i=s("fea5"),c=s("c9f1"),l={data:function(){return{basicInfo:{},readOnly:!1,canEdit:!1,canReject:!1,showTotal:!1,showComments:!1,cancelReject:!1,myAdditionMark:{},leaderAdditionMark:{},superior_score:{},need_attach_score:"",visible:!1,published:!1,level:"",targets:[],cardConfig:{min:0,max:5,step:.1},constants:{SUBMIT:o["me"],SAVE_DRAFT:o["ae"],APPEAL:o["g"],CANCEL_APPEAL:o["y"],LABEL_SELF:o["Ac"],LABEL_SUP:o["Ec"],LEADER_NUMBER:o["Lc"],LEADER_NAME:o["Kc"],BASIC_INFO:o["m"]},self_score:0,is_state:!1,old_s:!1,label_id:null,user_confirm:!1,is_appeal:!1,appeal_box_show:!1,appeal:[],is_cancel_appeal:!1,cancel_appeal_box_show:!1,is_confirm:!1,confirm_box_show:!1,label_name:"",superior_evaluation:!1,label_show:0}},components:{card:function(){return s.e("chunk-dc75259e").then(s.bind(null,"4e80"))},"addition-mark":function(){return s.e("chunk-30b39215").then(s.bind(null,"5923"))},"total-mark":function(){return s.e("chunk-38a3521f").then(s.bind(null,"5ea4"))},"reject-dialog":function(){return s.e("chunk-04fdaff2").then(s.bind(null,"4853"))},comments:function(){return s.e("chunk-4b29fa46").then(s.bind(null,"f160"))}},computed:{showMyAdditional:function(){return 1==this.need_attach_score&&(this.readOnly&&this.myAdditionMark.evaluation||!this.readOnly)},total:function(){var e=parseFloat(this.targets.map(function(e){return e.weights*(e.mark||0)}).reduce(function(e,t){return e+t},0)+(parseFloat(this.myAdditionMark.score)||0)).toFixed(8);return this.superior_score&&null!=this.superior_score.score?parseFloat(this.superior_score.score).toFixed(2):(Math.round(100*e)/100).toFixed(2)},score:function(){return(parseFloat(this.myAdditionMark.score)||0).toFixed(2)},cardData:function(){return this.published?this.targets:this.hideLeaderInfo(this.targets)}},methods:{hideLeaderInfo:function(e){return e.map(function(e){var t=Object(n["a"])({},e);return delete t.target_superior_score,t})},saveDraft:function(){var e=this,t=this.getPostData();return Object(i["bc"])(this.$route.params.orgID,this.$route.params.id,t).then(function(t){e.$message({type:"success",message:"草稿保存成功"}),e.getDetailInfo()}).catch(function(e){})},getPostData:function(){return{score:this.targets.map(function(e){var t=e.id,s=e.mark,a=e.desc;return{target_id:t,score:s,description:a}}),attach_score:{score:this.myAdditionMark.score||0,reason:this.myAdditionMark.evaluation||""},total_score:this.total}},checkTotal:function(){return parseFloat(this.total)>5},getInfo:function(){var e=this,t=this.$route.params.attach,s="slef"==t?i["r"]:i["q"];return s(this.$route.params.orgID,this.$route.params.id,"self").then(function(t){var s=t.targets,a=t.superior_workcode,r=t.need_attach_score,n=t.stage,o=t.self_attach_score,i=t.superior_attach_score,c=t.superior_score,l=t.superior_name,_=t.score_level,u=t.score,d=t.publish_status,p=t.self_score,h=t.appeal,f=t.is_appeal,m=t.is_cancel_appeal,b=t.is_confirm,g=t.is_state,v=t._s,k=t.label_id,y=t.label_name,w=t.label_show;e.basicInfo={superior_workcode:a,superior_name:l};var A=1==d;e.is_appeal=f,e.appeal=h,e.is_cancel_appeal=m,e.is_confirm=b,e.is_state=g,e.label_show=w,e.old_s=1==v&&1==w,e.label_id=k,e.label_name=y||c&&c.label_name,e.published=A,e.need_attach_score=r,e.myAdditionMark=o||{},e.leaderAdditionMark=i||{},e.superior_evaluation=null!=c&&null!=c.score,e.level=_||c&&c.score_level,e.superior_score=c,e.showComments=n>=40,e.self_score=null!=p?p.score:0,e.composeData(s,n),60!=n||u||(e.showTotal=!1),A&&(e.readOnly=!0,e.canEdit=!1)}).catch(function(e){})},beforeSubmitCheck:function(){var e=this;return new Promise(function(t,s){return e.targets.some(function(e){return!e.desc})?(e.$notify.error({title:o["zb"],message:"请填写目标的实际完成情况!"}),s(!0)):e.showMyAdditional&&e.myAdditionMark.score&&!e.myAdditionMark.evaluation?(e.$notify.error({title:o["zb"],message:"请填写加减分原因"}),s(!0)):e.checkTotal()?(e.$notify.error({title:o["zb"],message:"总分已经超过5分"}),s(!0)):t(!0)})},submit:function(){var e=this;return this.beforeSubmitCheck().then(function(){e.$confirm("自评分为".concat(e.total,"分，请确认无误再提交，一经提交无法修改, 是否继续?"),"提示",{confirmButtonText:o["C"],cancelButtonText:o["x"],type:"warning"}).then(function(){var t=e.getPostData();return delete t.total_score,Object(i["Tb"])(e.$route.params.id,t).then(function(t){e.$message({type:"success",message:o["D"]}),e.$router.replace(c["l"])}).catch(function(e){})}).catch(function(){})}).catch(function(){})},composeData:function(e,t){switch(t){case 10:this.readOnly=!0,this.targets=e.map(function(e){return delete e.target_self_score,delete e.target_superior_score,e}),this.need_attach_score="",this.canEdit=!1,this.showTotal=!1;break;case 20:this.readOnly=!1,this.canEdit=!0,this.showTotal=!0,this.targets=e.map(function(e){return e.mark=e.target_self_score&&e.target_self_score.score||0,e.desc=e.target_self_score&&e.target_self_score.description||"",delete e.target_self_score,delete e.target_superior_score,e});break;case 30:this.readOnly=!0,this.canEdit=!1,this.showTotal=!0,this.targets=e.map(function(e){return e.mark=e.target_self_score&&e.target_self_score.score||0,e.desc=e.target_self_score&&e.target_self_score.description||"",e});break;case 40:this.readOnly=!0,this.canEdit=!1,this.showTotal=!0,this.targets=e.map(function(e){return e.mark=e.target_self_score&&e.target_self_score.score||0,e.desc=e.target_self_score&&e.target_self_score.description||"",e}),this.canReject=!0,this.cancelReject=!1;break;case 50:this.readOnly=!0,this.canEdit=!1,this.showTotal=!0,this.targets=e.map(function(e){return e.mark=e.target_self_score&&e.target_self_score.score||0,e.desc=e.target_self_score&&e.target_self_score.description||"",e}),this.canReject=!1,this.cancelReject=!0;break;default:this.readOnly=!0,this.canEdit=!1,this.showTotal=!0,this.targets=e.map(function(e){return e.mark=e.target_self_score&&e.target_self_score.score||0,e.desc=e.target_self_score&&e.target_self_score.description||"",e}),this.canReject=!1,this.cancelReject=!1}},confirm_submit:function(){var e=this;return Object(i["a"])({performance_user_id:this.$route.params.id}).then(function(t){e.confirm_box_show=!1,e.$message({type:"success",message:"确认成功!"}),e.getInfo()}).catch(function(e){})},cancel_appeal_submit:function(){var e=this;return Object(i["e"])({performance_user_id:this.$route.params.id}).then(function(t){e.cancel_appeal_box_show=!1,e.$message({type:"success",message:"取消成功!"}),e.getInfo()}).catch(function(e){})}},created:function(){this.getInfo()}},_=l,u=(s("7b45"),s("2877")),d=Object(u["a"])(_,a,r,!1,null,"55acc384",null);t["default"]=d.exports},"7b45":function(e,t,s){"use strict";var a=s("dd94"),r=s.n(a);r.a},dd94:function(e,t,s){}}]);