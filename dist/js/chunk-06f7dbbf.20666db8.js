(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06f7dbbf"],{1311:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"self-grade-component"},[s("section",{staticClass:"mark"},[s("el-row",{attrs:{align:"middle",type:"flex"}},[s("el-col",{staticStyle:{padding:"20px","border-right":"1px solid #979797"}},[s("div",{staticClass:"mark-label"},[e._v("请选择评分项目")]),s("grade-items",{attrs:{items:e.questions},model:{value:e.selectGradeItem,callback:function(t){e.selectGradeItem=t},expression:"selectGradeItem"}}),s("br"),s("br"),s("div",{staticClass:"mark-label"},[e._v("请评分")]),s("br"),s("grade-slider",{attrs:{min:1,readOnly:e.readOnly,step:1,max:5},model:{value:e.questions[e.selectGradeItem].score,callback:function(t){e.$set(e.questions[e.selectGradeItem],"score",t)},expression:"questions[selectGradeItem].score"}})],1),s("el-col",{staticStyle:{"padding-left":"50px"}},[s("div",{staticClass:"mark-score"},[e._v("\n          "+e._s(e.questions[e.selectGradeItem].score&&e.questions[e.selectGradeItem].score>=0?e.questions[e.selectGradeItem].score:"")+"分\n        ")]),s("div",{staticClass:"mark-desc"},[e._v(e._s(e.contentForCurScore))])])],1)],1),s("br"),s("div",{directives:[{name:"show",rawName:"v-show",value:e.questions[e.selectGradeItem].score>=3,expression:"questions[selectGradeItem].score >= 3"}]},[s("case-area",{attrs:{readOnly:e.readOnly,placeholder:"请填写我的3分案例"},model:{value:e.questions[e.selectGradeItem].cases[0],callback:function(t){e.$set(e.questions[e.selectGradeItem].cases,0,t)},expression:"questions[selectGradeItem].cases[0]"}}),s("br"),s("div",{directives:[{name:"show",rawName:"v-show",value:e.questions[e.selectGradeItem].score>=4,expression:"questions[selectGradeItem].score >= 4"}]},[s("case-area",{attrs:{readOnly:e.readOnly,placeholder:"请填写我的4分案例"},model:{value:e.questions[e.selectGradeItem].cases[1],callback:function(t){e.$set(e.questions[e.selectGradeItem].cases,1,t)},expression:"questions[selectGradeItem].cases[1]"}}),s("br"),s("div",{directives:[{name:"show",rawName:"v-show",value:e.questions[e.selectGradeItem].score>=5,expression:"questions[selectGradeItem].score >= 5"}]},[s("case-area",{attrs:{readOnly:e.readOnly,placeholder:"请填写我的5分案例"},model:{value:e.questions[e.selectGradeItem].cases[2],callback:function(t){e.$set(e.questions[e.selectGradeItem].cases,2,t)},expression:"questions[selectGradeItem].cases[2]"}}),s("br")],1)],1)],1),s("el-row",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],attrs:{type:"flex",justify:"end"}},[e.neverSubmit?s("el-button",{attrs:{type:"primary"},on:{click:e.saveDraft}},[e._v(e._s(e.constants.SAVE_DRAFT))]):e._e(),s("el-button",{attrs:{type:"primary"},on:{click:e.submitGrade}},[e._v(e._s(e.constants.SUBMIT))])],1)],1)},a=[],n=(s("ac6a"),s("6762"),s("2fdb"),s("cebc")),c=(s("6c7b"),s("fea5")),o=s("38fb"),l={data:function(){return{selectGradeItem:0,neverSubmit:!0,questions:[{cases:["","",""]},{cases:["","",""]},{cases:["","",""]},{cases:["","",""]}],readOnly:!1,constants:{SUBMIT:o["Ud"],SAVE_DRAFT:o["Jd"]}}},components:{"grade-items":function(){return s.e("chunk-51b546f8").then(s.bind(null,"da3f"))},"grade-slider":function(){return s.e("chunk-4743ba3a").then(s.bind(null,"aa29"))},"case-area":function(){return s.e("chunk-502749a0").then(s.bind(null,"b5ec"))}},methods:{getGradeInfo:function(){var e=this,t=this.$route.params.id;Object(c["F"])(t).then(function(s){var r=1==s.is_new_record;e.neverSubmit=r,r?Object(c["G"])(t).then(function(t){e.preProcessQuestions(t.questions)}):e.preProcessQuestions(s.questions);var a=s.employee_name,n=s.employee_workcode,i=s.highlevel_name,o=s.highlevel_workcode,l=s.self_end_time,u=s.superior_name,d=s.superior_workcode;e.$parent.basicInfo={name:a,workcode:n,leaderLabel:"我的上级",superior_name:u,highlevel_name:i,superior_workcode:d,hightlevelLabel:"隔级上级",highlevel_workcode:o,finishedTime:"自评截止时间: ".concat(l)},e.readOnly=0==s.can_edit,e.$forceUpdate()})},preProcessQuestions:function(e){var t=this;e.map(function(e,s){if(!e.cases)return e.cases=new Array(3).fill(""),void t.$set(t.questions,s,Object(n["a"])({},e));if(3!=e.cases.length)for(var r=0;r<=3-e.cases.length;r++)e.cases[e.cases.length+r]="";t.$set(t.questions,s,Object(n["a"])({},e))})},scoreCheck:function(e,t){if(e.score==t){var s=this.caseValidate(i,t);if(-1!=s)return this.$message.error("".concat(i.question_name).concat(s+3,"分理由未填写，请填写后提交!")),!0}return!1},validateGrade:function(){var e=this;return this.questions.some(function(t){return t.score?!(![3,4,5].includes(parseInt(t.score))||!e.scoreCheck(t)):(e.$message.error("".concat(t.question_name,"评分未选择!")),!0)})},caseValidate:function(e,t){for(var s=t-3,r=0;r<=s;r++)if(void 0==e.cases[r]||0==e.cases[r].length)return r;return-1},composeData:function(){var e={};return this.filterCases(this.questions).forEach(function(t){e[t.question_id]={score:t.score,cases:t.cases.filter(function(e){return!!e})}}),e},filterCases:function(e){return e.map(function(e){return e.cases&&0!=e.cases.length&&(e.cases=e.cases.slice(0,e.score-2)),e})},submitGrade:function(){var e=this,t=this.validateGrade();if(!t){var s=this.composeData();Object(c["Mb"])(s,this.$route.params.id).then(function(t){e.$notify({title:o["Vd"],message:o["A"],type:"success"}),e.getGradeInfo()})}},saveDraft:function(){var e=this;Object(c["Kb"])(this.$route.params.id,Object(n["a"])({},this.composeData(),{type:1})).then(function(t){e.$notify({title:o["Vd"],message:o["V"],type:"success"})})}},computed:{contentForCurScore:function(){var e=this;return((this.questions[this.selectGradeItem].topics||[]).filter(function(t){return t.score==e.questions[e.selectGradeItem].score})[0]||{}).content}},created:function(){this.getGradeInfo()}},u=l,d=(s("c03e"),s("2877")),f=Object(d["a"])(u,r,a,!1,null,"20116ab8",null);t["default"]=f.exports},"2fdb":function(e,t,s){"use strict";var r=s("5ca1"),a=s("d2c8"),n="includes";r(r.P+r.F*s("5147")(n),"String",{includes:function(e){return!!~a(this,e,n).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},"36bd":function(e,t,s){"use strict";var r=s("4bf8"),a=s("77f1"),n=s("9def");e.exports=function(e){var t=r(this),s=n(t.length),c=arguments.length,i=a(c>1?arguments[1]:void 0,s),o=c>2?arguments[2]:void 0,l=void 0===o?s:a(o,s);while(l>i)t[i++]=e;return t}},5147:function(e,t,s){var r=s("2b4c")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(s){try{return t[r]=!1,!"/./"[e](t)}catch(a){}}return!0}},6762:function(e,t,s){"use strict";var r=s("5ca1"),a=s("c366")(!0);r(r.P,"Array",{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),s("9c6c")("includes")},"6c7b":function(e,t,s){var r=s("5ca1");r(r.P,"Array",{fill:s("36bd")}),s("9c6c")("fill")},"7a3c":function(e,t,s){},aae3:function(e,t,s){var r=s("d3f4"),a=s("2d95"),n=s("2b4c")("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[n])?!!t:"RegExp"==a(e))}},c03e:function(e,t,s){"use strict";var r=s("7a3c"),a=s.n(r);a.a},d2c8:function(e,t,s){var r=s("aae3"),a=s("be13");e.exports=function(e,t,s){if(r(t))throw TypeError("String#"+s+" doesn't accept regex!");return String(a(e))}}}]);