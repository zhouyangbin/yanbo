(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7dd57e1c"],{"51f8":function(t,e,n){"use strict";var s=n("5851"),a=n.n(s);a.a},5851:function(t,e,n){},ac13:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"set-target-page"},[n("section",{staticClass:"content-container"},[n("div",{staticClass:"basic-info"},[n("div",[n("span",{staticClass:"label"},[t._v(t._s(t.constants.BASIC_INFO)+":")]),n("span",[n("span",{staticClass:"greycolor"},[t._v(t._s(t.constants.LEADER_NUMBER))]),t._v("\n          / "+t._s(t.basicInfo.superior_workcode)+"   \n          "),n("span",{staticClass:"greycolor"},[t._v(t._s(t.constants.LEADER_NAME))]),t._v("\n          / "+t._s(t.basicInfo.superior_name)+"\n        ")]),t._v("    \n        "),n("span",{staticClass:"tip"},[t._v("注: 若上级姓名工号与实际不符, 请联系HR")])]),t.readOnly?t._e():n("div",[n("el-button",{attrs:{disabled:!t.canPlus,icon:"el-icon-plus",type:"text"},on:{click:function(e){t.targets.push({})}}},[t._v(t._s(t.constants.ADD_TARGET))]),n("el-button",{attrs:{icon:"el-icon-upload",type:"text"},on:{click:function(e){t.showImportDia=!0}}},[t._v(t._s(t.constants.UPLOAD_TARGET))])],1),t.readOnly&&t.can_edit_target?n("div",[n("el-button",{attrs:{icon:"el-icon-edit-outline",type:"text"},on:{click:function(e){t.readOnly=!1}}},[t._v("重新设定目标")])],1):t._e()]),t.hasRejectedReasons?n("div",t._l(t.target_reject,function(e,s){return n("el-row",{key:s,staticClass:"rejectFrame",attrs:{type:"flex",justify:"space-between"}},[n("div",{staticClass:"reason"},[t._v(t._s(e.reason))]),n("div",[t._v(t._s(e.created_at))])])})):t._e(),t._l(t.targets,function(e,s){return n("target-card",{key:s,attrs:{keys:t.keys,readOnly:t.readOnly,data:t.targets[s],index:s},on:{delete:t.deleteTarget,"update:data":function(e){t.$set(t.targets,s,e)}}})}),n("br"),n("el-row",{attrs:{type:"flex",justify:"center"}},[t.submitted?t._e():n("el-button",{on:{click:t.saveDraft}},[t._v(t._s(t.constants.SAVE_DRAFT))]),!t.readOnly&&t.can_edit_target?n("el-button",{attrs:{type:"primary"},on:{click:t.sumbit}},[t._v(t._s(t.constants.SUBMIT))]):t._e()],1)],2),t.showImportDia?n("import-target",{attrs:{visible:t.showImportDia},on:{refresh:t.getInfo,"update:visible":function(e){t.showImportDia=e}}}):t._e()],1)},a=[],r=(n("456d"),n("ac6a"),n("c93e")),i=(n("cadf"),n("551c"),n("097d"),n("38fb")),c=n("fea5"),o={data:function(){return{basicInfo:{},showImportDia:!1,constants:{BASIC_INFO:i["l"],LEADER_NUMBER:i["Cc"],LEADER_NAME:i["Bc"],ADD_TARGET:i["d"],UPLOAD_TARGET:i["fe"],SAVE_DRAFT:i["Jd"],SUBMIT:i["Ud"]},targets:[{},{},{}],keys:[],readOnly:!1,submitted:!0,can_edit_target:!0,target_reject:[]}},components:{"target-card":function(){return n.e("chunk-9670afdc").then(n.bind(null,"a872"))},"import-target":function(){return n.e("chunk-7dad60ba").then(n.bind(null,"6888"))}},methods:{deleteTarget:function(t){this.targets.splice(t,1)},beforeRouteLeave:function(t,e,n){this.readOnly?n():this.$confirm("修改完成后请提交，否则修改将不被保存?",i["j"],{confirmButtonText:i["z"],cancelButtonText:i["u"],type:"warning"}).then(function(){n()}).catch(function(){n(!1)})},saveDraft:function(){var t=this,e=this.targets.map(function(t){var e=Object(r["a"])({},t);return e.weights=e.weights/100,e});Object(c["sb"])(this.$route.params.id,{target:e}).then(function(e){t.$message({message:i["V"],type:"success"})}).catch(function(t){})},isAllFilled:function(){var t=this;return!this.targets.some(function(e){return t.keys.some(function(t){return!e[t]})})},checkWeightsSum:function(){return 100==this.targets.map(function(t){return t.weights}).reduce(function(t,e){return parseInt(t)+parseInt(e)},0)},sumbit:function(){var t=this;if(!this.targetNum)return this.$message({message:"请填写至少一个目标",type:"warning"});this.isAllFilled()?this.checkWeightsSum()?Object(c["rb"])(this.$route.params.id,{target:this.targets.map(function(t){var e=Object(r["a"])({},t);return e.weights=e.weights/100,e})}).then(function(e){t.$emit("refresh")}).catch(function(t){}):this.$message({message:"请将目标权重总和应为100!",type:"warning"}):this.$message({message:"请将目标填写完整后再提交!",type:"warning"})},getInfo:function(){var t=this;Object(c["n"])(this.$route.params.orgID,this.$route.params.id,"self").then(function(e){e.stage;var n=e.superior_workcode,s=e.superior_name,a=e.targets,r=e.template,i=e.can_edit_target,c=e.target_reject;if(t.basicInfo={superior_workcode:n,superior_name:s},t.keys=Object.keys(r||{}),t.can_edit_target=1==i,t.target_reject=c||[],a&&a.length>0)return t.readOnly=!0,void(t.targets=a.map(function(t){return t.weights=parseInt(100*t.weights),t}));t.submitted=!1,t.getDraft()})},getDraft:function(){var t=this;Object(c["P"])(this.$route.params.id).then(function(e){var n=e.targets;t.targets=n.map(function(t){return t.weights=parseInt(100*t.weights),t})}).catch(function(t){})}},computed:{canPlus:function(){return this.targetNum<10},targetNum:function(){return this.targets.length},hasRejectedReasons:function(){return this.target_reject.length>0}},created:function(){this.getInfo()}},u=o,l=(n("51f8"),n("2877")),f=Object(l["a"])(u,s,a,!1,null,"0dd692c2",null);f.options.__file="index.vue";e["default"]=f.exports}}]);