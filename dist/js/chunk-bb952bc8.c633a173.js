(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bb952bc8"],{"08ad":function(t,e,s){"use strict";var a=s("1f54"),r=s.n(a);r.a},"08d2":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"my-grade-page"},[s("section",{staticClass:"content-container"},[s("div",{staticClass:"basic-info"},[s("span",{staticClass:"label"},[t._v(t._s(t.constants.BASIC_INFO)+":")]),s("span",[s("span",{staticClass:"greycolor"},[t._v(t._s(t.constants.LEADER_NUMBER))]),t._v("\n        / "+t._s(t.basicInfo.superior_workcode)+"   \n        "),s("span",{staticClass:"greycolor"},[t._v(t._s(t.constants.LEADER_NAME))]),t._v("\n        / "+t._s(t.basicInfo.superior_name)+" ")]),t._v("    \n      "),s("span",{staticClass:"tip"},[t._v("注: 若上级姓名工号与实际不符, 请联系HR")])]),s("br"),t._l(t.cardData,function(e,a){return s("card",{key:a,staticClass:"card",attrs:{readOnly:t.readOnly,placeholder:"请描述该项目标的实际完成情况",desc:t.targets[a].desc,config:t.cardConfig,data:e,index:a},on:{"update:desc":function(e){return t.$set(t.targets[a],"desc",e)}},model:{value:t.targets[a].mark,callback:function(e){t.$set(t.targets[a],"mark",e)},expression:"targets[i].mark"}})}),s("br"),t.showComments&&t.superior_score&&t.superior_score.evaluation&&t.published?s("div",[s("comments",{attrs:{readOnly:!0,comments:t.superior_score&&t.superior_score.evaluation},on:{"update:comments":function(e){return t.$set(t.superior_score&&t.superior_score,"evaluation",e)}}}),s("br")],1):t._e(),t.showMyAdditional?s("div",[s("addition-mark",{attrs:{prefixTitle:t.constants.LABEL_SELF,readOnly:t.readOnly,desc:t.myAdditionMark.evaluation,mark:t.myAdditionMark.score},on:{"update:desc":function(e){return t.$set(t.myAdditionMark,"evaluation",e)},"update:mark":function(e){return t.$set(t.myAdditionMark,"score",e)}}}),s("br")],1):t._e(),t.leaderAdditionMark.evaluation&&t.published?s("div",[s("addition-mark",{attrs:{readOnly:!0,prefixTitle:t.constants.LABEL_SUP,desc:t.leaderAdditionMark.evaluation,mark:t.leaderAdditionMark.score},on:{"update:desc":function(e){return t.$set(t.leaderAdditionMark,"evaluation",e)},"update:mark":function(e){return t.$set(t.leaderAdditionMark,"score",e)}}}),s("br")],1):t._e(),t.showTotal&&t.canEdit?s("div",[s("total-mark",{attrs:{total:t.total,score:t.total,high_level_show:t.published}}),s("br")],1):t._e(),t.showTotal&&!t.canEdit?s("div",[s("total-mark",{attrs:{total:t.total,score:t.self_score,high_level_show:t.published}}),s("br")],1):t._e(),s("div",[t.level&&t.published?s("el-row",{staticClass:"level-section",attrs:{type:"flex",justify:"end"}},[s("el-col",{attrs:{span:4}},[s("el-row",{attrs:{justify:"center"}},[s("el-col",{attrs:{span:6}},[s("span",{staticStyle:{"line-height":"40px"}},[t._v("结果/")])]),s("el-col",{attrs:{span:18}},[s("span",{staticClass:"level"},[t._v("\n                "+t._s(t.level)+"\n              ")])])],1),s("br"),t.label_name?s("el-row",[s("el-col",{attrs:{span:6}},[t._v("标签/")]),s("el-tag",{class:"A"==t.level||"S"==t.level?"status-tag top-style":"status-tag other-style"},[t._v(t._s(t.label_name))])],1):t._e()],1)],1):t._e()],1),t.canEdit?s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-button",{staticClass:"btn-reset",attrs:{round:"",size:"medium"},on:{click:t.saveDraft}},[t._v("\n        "+t._s(t.constants.SAVE_DRAFT)+"\n      ")]),s("el-button",{attrs:{round:"",size:"medium",type:"primary"},on:{click:t.submit}},[t._v("\n        "+t._s(t.constants.SUBMIT)+"\n      ")])],1):t._e(),t.is_confirm||t.is_appeal||t.is_cancel_appeal?s("p",{staticStyle:{color:"#eb0c00"}},[t._v("\n      请注意：到期将默认确认结果, 如有问题可点击申诉\n    ")]):t._e(),s("p",{staticStyle:{width:"100%","word-break":"break-all",color:"#ff8519"}},t._l(t.appeal,function(e,a){return s("span",{key:a},[t._v("\n        申诉理由："+t._s(e.reason)+" "),s("br")])}),0),s("el-row",{attrs:{type:"flex",justify:"center"}},[t.is_confirm?s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.confirm_box_show=!0}}},[t._v("\n        确认\n      ")]):t._e(),t.is_appeal?s("el-button",{attrs:{type:"warning"},on:{click:function(e){t.appeal_box_show=!0}}},[t._v("\n        申诉\n      ")]):t._e(),t.is_cancel_appeal?s("el-button",{attrs:{type:"warning"},on:{click:function(e){t.cancel_appeal_box_show=!0}}},[t._v("\n        取消申诉\n      ")]):t._e()],1),s("el-dialog",{staticClass:"dialog",attrs:{title:"提示",visible:t.confirm_box_show,width:"30%"},on:{"update:visible":function(e){t.confirm_box_show=e}}},[s("p",{staticClass:"text-center"},[t._v("是否确认成绩")]),s("span",{staticClass:"text-center",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.confirm_box_show=!1}}},[t._v("\n          取消\n        ")]),s("el-button",{attrs:{type:"primary"},on:{click:t.confirm_submit}},[t._v("\n          确认\n        ")])],1)]),s("reject-dialog",{attrs:{visible:t.appeal_box_show},on:{close:t.getInfo,"update:visible":function(e){t.appeal_box_show=e}}}),s("el-dialog",{staticClass:"dialog",attrs:{title:"提示",visible:t.cancel_appeal_box_show,width:"30%"},on:{"update:visible":function(e){t.cancel_appeal_box_show=e}}},[s("p",{staticClass:"text-center"},[t._v("\n        取消申诉将默认认为自动确认当前成绩，是否继续？\n      ")]),s("span",{staticClass:"text-center",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.cancel_appeal_box_show=!1}}},[t._v("\n          取消\n        ")]),s("el-button",{attrs:{type:"primary"},on:{click:t.cancel_appeal_submit}},[t._v("\n          确认\n        ")])],1)])],2)])},r=[],n=(s("a481"),s("cebc")),o=s("38fb"),i=s("fea5"),c=s("c9f1"),l={data:function(){return{basicInfo:{},readOnly:!1,canEdit:!1,canReject:!1,showTotal:!1,showComments:!1,cancelReject:!1,myAdditionMark:{},leaderAdditionMark:{},superior_score:{},need_attach_score:"",visible:!1,published:!1,level:"",targets:[],cardConfig:{min:0,max:5,step:.1},constants:{SUBMIT:o["me"],SAVE_DRAFT:o["ae"],APPEAL:o["g"],CANCEL_APPEAL:o["y"],LABEL_SELF:o["Ac"],LABEL_SUP:o["Ec"],LEADER_NUMBER:o["Lc"],LEADER_NAME:o["Kc"],BASIC_INFO:o["m"]},self_score:0,is_state:!1,old_s:!1,label_id:null,user_confirm:!1,is_appeal:!1,appeal_box_show:!1,appeal:[],is_cancel_appeal:!1,cancel_appeal_box_show:!1,is_confirm:!1,confirm_box_show:!1,label_name:""}},components:{card:function(){return s.e("chunk-5c490880").then(s.bind(null,"4e80"))},"addition-mark":function(){return s.e("chunk-99af4336").then(s.bind(null,"5923"))},"total-mark":function(){return s.e("chunk-38a3521f").then(s.bind(null,"5ea4"))},"reject-dialog":function(){return s.e("chunk-74832d80").then(s.bind(null,"4853"))},comments:function(){return s.e("chunk-38427ed5").then(s.bind(null,"f160"))}},computed:{showMyAdditional:function(){return 1==this.need_attach_score&&(this.readOnly&&this.myAdditionMark.evaluation||!this.readOnly)},total:function(){var t=parseFloat(this.targets.map(function(t){return t.weights*(t.mark||0)}).reduce(function(t,e){return t+e},0)+(parseFloat(this.myAdditionMark.score)||0)).toFixed(8);return this.superior_score&&null!=this.superior_score.score?parseFloat(this.superior_score.score).toFixed(2):(Math.round(100*t)/100).toFixed(2)},score:function(){return(parseFloat(this.myAdditionMark.score)||0).toFixed(2)},cardData:function(){return this.published?this.targets:this.hideLeaderInfo(this.targets)}},methods:{hideLeaderInfo:function(t){return t.map(function(t){var e=Object(n["a"])({},t);return delete e.target_superior_score,e})},saveDraft:function(){var t=this,e=this.getPostData();return Object(i["ac"])(this.$route.params.orgID,this.$route.params.id,e).then(function(e){t.$message({type:"success",message:"草稿保存成功"}),t.getDetailInfo()}).catch(function(t){})},getPostData:function(){return{score:this.targets.map(function(t){var e=t.id,s=t.mark,a=t.desc;return{target_id:e,score:s,description:a}}),attach_score:{score:this.myAdditionMark.score||0,reason:this.myAdditionMark.evaluation||""},total_score:this.total}},checkTotal:function(){return parseFloat(this.total)>5},getInfo:function(){var t=this;return Object(i["q"])(this.$route.params.orgID,this.$route.params.id,"self").then(function(e){var s=e.targets,a=e.superior_workcode,r=e.need_attach_score,n=e.stage,o=e.self_attach_score,i=e.superior_attach_score,c=e.superior_score,l=e.superior_name,_=e.score_level,u=e.score,d=e.publish_status,p=e.self_score,h=e.appeal,f=e.is_appeal,m=e.is_cancel_appeal,b=e.is_confirm,g=e.is_state,v=e._s,k=e.label_id,y=e.label_name,w=e.label_show;t.basicInfo={superior_workcode:a,superior_name:l};var A=1==d;t.is_appeal=f,t.appeal=h,t.is_cancel_appeal=m,t.is_confirm=b,t.is_state=g,t.old_s=1==v&&1==w,t.label_id=k,t.label_name=y||c&&c.label_name,t.published=A,t.need_attach_score=r,t.myAdditionMark=o||{},t.leaderAdditionMark=i||{},t.level=_||c&&c.score_level,t.superior_score=c,t.showComments=n>=40,t.self_score=null!=p?p.score:0,t.composeData(s,n),60!=n||u||(t.showTotal=!1),A&&(t.readOnly=!0,t.canEdit=!1)}).catch(function(t){})},beforeSubmitCheck:function(){var t=this;return new Promise(function(e,s){return t.targets.some(function(t){return!t.desc})?(t.$notify.error({title:o["zb"],message:"请填写目标的实际完成情况!"}),s(!0)):t.showMyAdditional&&t.myAdditionMark.score&&!t.myAdditionMark.evaluation?(t.$notify.error({title:o["zb"],message:"请填写加减分原因"}),s(!0)):t.checkTotal()?(t.$notify.error({title:o["zb"],message:"总分已经超过5分"}),s(!0)):e(!0)})},submit:function(){var t=this;return this.beforeSubmitCheck().then(function(){t.$confirm("自评分为".concat(t.total,"分，请确认无误再提交，一经提交无法修改, 是否继续?"),"提示",{confirmButtonText:o["C"],cancelButtonText:o["x"],type:"warning"}).then(function(){var e=t.getPostData();return delete e.total_score,Object(i["Sb"])(t.$route.params.id,e).then(function(e){t.$message({type:"success",message:o["D"]}),t.$router.replace(c["l"])}).catch(function(t){})}).catch(function(){})}).catch(function(){})},composeData:function(t,e){switch(e){case 10:this.readOnly=!0,this.targets=t.map(function(t){return delete t.target_self_score,delete t.target_superior_score,t}),this.need_attach_score="",this.canEdit=!1,this.showTotal=!1;break;case 20:this.readOnly=!1,this.canEdit=!0,this.showTotal=!0,this.targets=t.map(function(t){return t.mark=t.target_self_score&&t.target_self_score.score||0,t.desc=t.target_self_score&&t.target_self_score.description||"",delete t.target_self_score,delete t.target_superior_score,t});break;case 30:this.readOnly=!0,this.canEdit=!1,this.showTotal=!0,this.targets=t.map(function(t){return t.mark=t.target_self_score&&t.target_self_score.score||0,t.desc=t.target_self_score&&t.target_self_score.description||"",t});break;case 40:this.readOnly=!0,this.canEdit=!1,this.showTotal=!0,this.targets=t.map(function(t){return t.mark=t.target_self_score&&t.target_self_score.score||0,t.desc=t.target_self_score&&t.target_self_score.description||"",t}),this.canReject=!0,this.cancelReject=!1;break;case 50:this.readOnly=!0,this.canEdit=!1,this.showTotal=!0,this.targets=t.map(function(t){return t.mark=t.target_self_score&&t.target_self_score.score||0,t.desc=t.target_self_score&&t.target_self_score.description||"",t}),this.canReject=!1,this.cancelReject=!0;break;default:this.readOnly=!0,this.canEdit=!1,this.showTotal=!0,this.targets=t.map(function(t){return t.mark=t.target_self_score&&t.target_self_score.score||0,t.desc=t.target_self_score&&t.target_self_score.description||"",t}),this.canReject=!1,this.cancelReject=!1}},confirm_submit:function(){var t=this;return Object(i["a"])({performance_user_id:this.$route.params.id}).then(function(e){t.confirm_box_show=!1,t.$message({type:"success",message:"确认成功!"}),t.getInfo()}).catch(function(t){})},cancel_appeal_submit:function(){var t=this;return Object(i["e"])({performance_user_id:this.$route.params.id}).then(function(e){t.cancel_appeal_box_show=!1,t.$message({type:"success",message:"取消成功!"}),t.getInfo()}).catch(function(t){})}},created:function(){this.getInfo()}},_=l,u=(s("08ad"),s("2877")),d=Object(u["a"])(_,a,r,!1,null,"21ec8a40",null);e["default"]=d.exports},"1f54":function(t,e,s){}}]);